---
layout: customPost
title:  "Git Step-3 : Branch"
categories: 
  - Tools
  - Git
  
toc: true
toc_label: "Git Step-3 : Branch"
toc_sticky: true 
---
## 1. Branch란?

- 커밋 포인터

  git add 명령은 Working Directory에 있는 UnTracked 또는 Modified 상태의 파일을 git 저장소에 저장하고(Blob), Staging Area에는 해당 파일의 체크섬을 저장합니다. (체크섬은 [SHA-1](https://ko.wikipedia.org/wiki/SHA){:target="_blank"} 16진수 40자리)
  
  git commit명령은 Staging Area에 있는 커밋의 포인터, 저자나 메시지 같은 메타 데이터, 이전 커밋의 대한 포인터 등을 포함하는 커밋 Object를 저장합니다. 그래서 git은 현재 커밋이 무엇이 변경 되었는지 알 수 있으며 최초 커밋을 제외한 나머지 커밋은 이전 커밋 포인터가 적어도 하나씩은 있고 브랜치를 Merge한 커밋의 경우 이전 커멋의 포인터가 여러개가 있습니다.
  

![image-20210302054304515](/assets/images/posts/image-20210302054304515.png)

![image-20210302054328453](/assets/images/posts/image-20210302054328453.png)

  

  Git의 브랜치는 커밋 포인터를 가볍게 이동할 수 있고, 처음 커밋하면 이 master 브랜치가 생성된 커밋을 가리킵니다. 이후 커밋을 만들면 master branch는 자동으로 마지막 커밋을 가리킵니다.

  ![image-20210302060500409](/assets/images/posts/image-20210302060500409.png)

  

  master branch는 git init 명령으로 초기화할 때 자동으로 만들어지는 기본 branch입니다. HEAD는 현재 git이 가르키고 있는 local branch입니다.

  ![image-20210302061126845](/assets/images/posts/image-20210302061126845.png)

  

- branch 생성

  `git branch <branch name>` 명령으로 branch를 생성할 수 있습니다. 

  ```
  $git branch testing
  ```

  새로 만든 testing branch는 현재 작업중인 마지막 커밋을 가리키고,  head는 아직 master branch를 가르키고 있는 상태가 됩니다.

  ![image-20210302063157860](/assets/images/posts/image-20210302063157860.png)

  ![image-20210302063241132](/assets/images/posts/image-20210302063241132.png)

  

  `git log --decorate` 명령으로 branch가 어떤 커밋을 가리키는지 확인할 수 있습니다.

  ```
  $git log --decorate
  commit 59e1dffacbda1bcdea5d0005baa2dbe76ab1dc88 (HEAD -> master, testing)
  Author: donghyeok <donghyeok.jh@gmail.com>
  Date:   Tue Mar 2 06:16:28 2021 +0900
  
      check branch
  ```

​		

- branch 이동

  `git checkout <branch name>` 명령으로 다른 branch로 이동하며 HEAD는 이동한 branch를 가르킵니다.

  ```
  $git checkout testing
  Switched to branch 'testing'
  ```

  ![image-20210302064242399](/assets/images/posts/image-20210302064242399.png)

  testing branch에서 파일을 하나 생성하고 commit 후 로그를 확인하면 HEAD가 testing branch를 가르키고 있는 것을 확인할 수 있습니다.

  ```
  $git commit -m "testing branch commit"
  [testing 096aca5] testing branch commit
   1 file changed, 1 insertion(+)
   create mode 100644 testing_newfile.txt
   
  $git log --decorate
  commit 096aca5ae84fe44b0b3d17652b1fd3464d26ca5b (HEAD -> testing)
  Author: donghyeok <donghyeok.jh@gmail.com>
  ```

  testing branch에서 새로운 커밋을 하나 만들었기 때문에 testing branch는 새로 만든 커밋을 가르키고, master branch는 그전 커밋을 가르키는 상태가 됩니다.

  ![image-20210302065107143](/assets/images/posts/image-20210302065107143.png)

  이 상태에서 master branch로 되돌아 가보면  HEAD도 master branch로 변경되었지만, testing에서 커밋한 정보는 안보이게 됩니다. working directory도 master branch 기준으로 변경됩니다. (단, 파일 변경시 문제가 있다면 브랜치 이동 명령을 실행되지 않습니다.)

  ```
  $git checkout master
  Switched to branch 'master'
  ```

  ![image-20210302065422574](/assets/images/posts/image-20210302065422574.png)

  ![image-20210302065752848](/assets/images/posts/image-20210302065752848.png)

  현재 branch가 가리키고 있는 히스토리가 무엇이고 어떻게 갈라져 나왔는지 볼려면 `git log --oneline --decorate --graph --all` 명령어를 실행합니다.

  ```
  $git log --oneline --decorate --graph --all
  ```

  ![image-20210302072912776](/assets/images/posts/image-20210302072912776.png)

  ![image-20210302074446040](/assets/images/posts/image-20210302074446040.png)

  Git의 branch는 어떤 한 커밋을 가리키는 40자의 SHA-1 체크섬 파일에 불과합니다. 그래서 만들기도 쉽고 지우기도 쉽습니다. 새로 branch를 하나 만드는 것은 41btye(40btye의 체크섬과 1byte 줄바꿈 문자)에 불과합니다. branch를 생성할 때 프로젝트를 통째로 복사해야하는 다른 VCS와의 차이는 극명합니다.

  

## 2.  Branch 기초

- `git branch` 현재 생성된 브랜치 및 head branch 정보를 알 수 있습니다.

  ```
  $git branch
    master
    testing
    testing2
  * testing3
  ```

  `git branch -v` 명령은 브랜치 마다 마지막 커밋 메시지도 함께 보여줍니다.

  ```
  $git branch -v
    conflictTestBranch cc2fb517 modify conflict branch
  * master             88d73a25 modify conflict file
    testing2           59e1dffa check branch
  ```

  

- `git checkout -b <branch name>` 명령으로 branch 생성과 checkout을 동시에 할 수 있습니다.

  ```
  $git checkout -b testing3
  Switched to a new branch 'testing3'
  ```

- checkout 명령으로 branch를 이동할려고 할 때 checkout할 branch와 head branch에 commit하지 않은 파일이 충돌나면 branch를 변경할 수 없습니다.

- Branch Merge

  새로 만든 testing3 branch에서 file하나를 만들고 커밋한 후 master branch와 merge합니다.

  ![image-20210302235633127](/assets/images/posts/image-20210302235633127.png)

  merge할 때 메시지를 보면 `Fast-forward`라는 단어가 나옵니다. 이것은 testing3 branch가 가리키고 있는 커밋이 master branch가 가리키고 있는 커밋을 참조하고 있기 때문에 master branch의 참조 포인터를 testing3 branch가 가르키고 있는 커밋으로 옮겨주기만 하는 방식입니다.

  ![image-20210303000910403](/assets/images/posts/image-20210303000910403.png)

  이번엔 merge할 testing branch가 가르키고 있는 커밋이 master branch가 가리키고 있는 커밋과 다른 방향으로 진행 중인 상태 즉 testing branch 생성 이후 커밋을 2번 이상한 경우에는 각 브랜치가 가르키고 있는 커밋의 공통 조상을 하나 만들어 3-way Merge 커밋을 하게 됩니다.

  ![image-20210303004200683](/assets/images/posts/image-20210303004200683.png)

  ![image-20210303004900249](/assets/images/posts/image-20210303004900249.png)

- branch 삭제

  용도를 다 한 branch는 `git branch -d <branch name>` 명령으로 삭제합니다.

  ```
  $git branch -d testing3
  Deleted branch testing3 (was 3f98b9c).
  
  $git log --oneline 
  삭제전: 3f98b9c (HEAD -> master, testing3) testing3 commit-3
  삭제후: 3f98b9c (HEAD -> master) testing3 commit-3
  ```

  merge가 완료되었거나 변경내역이 없는 branch의 경우에는 `git branch -d <branch name>`명령으로 삭제가 가능하지만 변경내역이 존재하는데 merge가 안된 경우에는 branch 삭제 시에 오류가 발생합니다. 만약 강제로 삭제하려면 `git branch -D <branch name>` 명령을 사용해야 합니다.
  
  ```
  $git branch -d newbranch
  Deleted branch newbranch (was 88d73a25).
  
  $git checkout -b newbranch2
  Switched to a new branch 'newbranch2'
  $vim new.txt
  $git add .
  $git commit -m "modify"
  [newbranch2 d114a60d] modify
   1 file changed, 1 insertion(+), 1 deletion(-)
  $git checkout master
  Switched to branch 'master'
  
  git branch -d newbranch2
  error: The branch 'newbranch2' is not fully merged.
  If you are sure you want to delete it, run 'git branch -D newbranch2'.
  
  git branch -D newbranch2
  Deleted branch newbranch2 (was d114a60d).
  ```
  
  

## 3. 충돌

- 두 개의 branch에서 동일한 파일을 수정한 상태에서 Merge를 하려고 하면 Conflict가 발생하고 개발자가 이를 해결해야 Merge가 가능합니다.

  Conflict가 발생할 때 git status 명령으로 확인하면 Unmerged 상태의 파일을 알려줍니다.

  ```
  $git merge conflictTestBranch
  Auto-merging new.txt
  CONFLICT (content): Merge conflict in new.txt
  Automatic merge failed; fix conflicts and then commit the result.
  
  $git status
  On branch master
  You have unmerged paths.
    (fix conflicts and run "git commit")
    (use "git merge --abort" to abort the merge)
  
  Unmerged paths:
    (use "git add <file>..." to mark resolution)
          both modified:   new.txt
  
  no changes added to commit (use "git add" and/or "git commit -a")
  ```

  충돌난 파일을 열어보면 충돌이 난 부분을 표준 형식에 따라 표시 해줍니다.

  ```
  1aa111
  222aa
  bbbbbbbbbbbbbbbb
  <<<<<<< HEAD
  master branch
  =======
  conflict branch
  >>>>>>> conflictTestBranch
  ```

  둘 중 하나를 선택하고 나머지는 삭제합니다.

  ```
  1aa111
  222aa
  bbbbbbbbbbbbbbbb
  conflict branch
  ```

  git commit 후  git log를 확인하면 정상적으로 Merge된 걸 알 수 있습니다.

  ```
  $git commit -a -m "modify conflict file"
  
  $git log --oneline --graph --all
  *   88d73a25 (HEAD -> master) modify conflict file
  |\
  | * cc2fb517 (conflictTestBranch) modify conflict branch
  * | b0fefe61 modify master branch
  |/
  * 4fe02393 modify B
  ```

  conflict 후 commit message는 어떻게 충돌을 해결했고 좀 더 확인해야 하는 부분은 무엇이고 왜 그렇게 해결했는지에 대해서 자세하게 기록한다. 자세한 기록은 나중에 이 Merge 커밋을 이해하는데 도움을 준다.

  

## 4. 브랜치 워크플로

- Long-Running Branch

  배포 또는 Stable 버전을 Master Branch로 관리하고 develop, hotfix, next 등 topic branch로 기능 구현 및 테스트 후 Master Branch에 Merge합니다.

  topic branch는 어떤 한 가지 주제나 작업을 위해 만든 브랜치입니다.

![image-20210304003114111](/assets/images/posts/image-20210304003114111.png)



## 5. Remote Branch

remote Refs는 remote 저장소에 있는 branch, tag 등의 포인터 레퍼런스 입니다.

`git ls-remote <remote>` 명령으로 모든 remote Refs를 조회할 수 있습니다.

```
$git ls-remote ts
4cdb5fe1a74dc6d2cac2143dcc8d9929fc84ea82        HEAD
92d673b5ae282df80213f9543c7373c333a91ef1        refs/heads/flexbox-sticky-footer
99c60f5957eca32b8612ddae0d87e72b94c9bac0        refs/heads/gh-pages-2.2.1
1f1aa440b171b711f4eae360d1d4b82fd2cae4c7        refs/heads/gh-pages-3.1.6
4cdb5fe1a74dc6d2cac2143dcc8d9929fc84ea82        refs/heads/master
075482c3832bde4f00908d976c2177b9f7beea02        refs/heads/navbar-menu
...
```

git remote show <remote> 명령은 모든 remote branch와 그 정보를 보여줍니다.

```
$git remote show ts
* remote ts
  Fetch URL: https://github.com/donghyeok-dev/donghyeok-dev.github.io.git
  Push  URL: https://github.com/donghyeok-dev/donghyeok-dev.github.io.git
  HEAD branch: master
  Remote branches:
    flexbox-sticky-footer tracked
    gh-pages-2.2.1        tracked
    gh-pages-3.1.6        tracked
    master                tracked
    navbar-menu           tracked
  Local ref configured for 'git push':
    master pushes to master (local out of date)
```


---
layout: customPost
title:  "Mockito"
categories: 
  - Spring
  - Test
---

##  Mockito

Mock: 진짜 객체와 비슷한 동작을 하지만 개발자가 직접 행동을 관리하는 객체.

Mockito : Mock 객체를 쉽게 만들고 관리하고 검증할 수 있는 방법을 제공하는 프레임워크이며 Mockito 이외에도 JMock, EasyMock 등이 있음.



spring boot는 기본적으로 spring-boot-starter-test가 dependencies에 포함되어 있고 아래와 같은 것들이 포함되어 있음.

```
testImplementation 'org.springframework.boot:spring-boot-starter-test'
```

- JUnit5
- Spring Test
- AssertJ
- Hamcrest
- Mockito
- JsonPath
- JSONassert



### 간단한 예제 

구현체가 없는  Service Interface에 정의된 함수를 Mockito를 이용해 테스트 하는 예제.

MockitoController.java

```java
package com.example.tdd1;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MockitoController {

    private final MockitoService mockitoService;

    public MockitoController(MockitoService mockitoService) {
        this.mockitoService = mockitoService;
    }

    @GetMapping("/example1")
    public Integer example1(Integer value1, Integer value2) {
        return this.mockitoService.calculateValue(value1, value2);
    }
}

```

MockitoService.java

```java
package com.example.tdd1;

import java.util.List;

public interface MockitoService {
    public List<MockitoDto> getDataList(MockitoDto dto);
    public int calculateValue(int a, int b);
}
```

MockitoControllerTest.java

```java
package com.example.tdd1;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.test.context.junit.jupiter.web.SpringJUnitWebConfig;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.test.web.servlet.MvcResult;
import org.springframework.test.web.servlet.setup.MockMvcBuilders;

import static org.mockito.Mockito.*;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.log;

@SpringJUnitWebConfig
class MockitoControllerTest {
    MockMvc mockMvc;
    MockitoService mockitoService;

    @BeforeEach
    void setUp() {
        this.mockitoService = mock(MockitoService.class);
        this.mockMvc = MockMvcBuilders.standaloneSetup(new MockitoController(mockitoService))
                .alwaysDo(log())
                .build();
    }

    @Test
    @DisplayName("mockito 기본 테스트")
    void mockitoTest1() throws Exception {
        //given
        final int value1 = 3;
        final int value2 = 5;

        when(this.mockitoService.calculateValue(value1, value2)).thenReturn(value1 * value2);

        //when
        MvcResult mvcResult = this.mockMvc.perform(get("/example1")
                .param("value1", String.valueOf(value1))
                .param("value2", String.valueOf(value2))).andReturn();

        //then
        verify(this.mockitoService).calculateValue(value1, value2);
        Assertions.assertEquals(mvcResult.getResponse().getContentAsString(), String.valueOf(value1 * value2));
    }
}
```



### @Mock

```java
import org.mockito.Mock;
```



answer: 상호 작용에 대한 기본 대답을 지정합니다.

```java
Answers answer() default Answers.RETURNS_DEFAULTS;
예)
Foo mock = mock(Foo.class, withSettings().defaultAnswer(RETURNS_SMART_NULLS));
         Foo mockTwo = mock(Foo.class, withSettings().defaultAnswer(new YourOwnAnswer()));
      
//Below does exactly the same:
Foo mockTwo = mock(Foo.class, new YourOwnAnswer());
```

stubOnly : 스텁 전용 모의는 메서드 호출을 기록하지 않으므로 메모리를 저장하지만 호출 확인을 허용하지 않습니다.

```java
boolean stubOnly() default false;
예)
List stubOnly = mock(List.class, withSettings().stubOnly());
```

name: 이름을 지정합니다.

```java
String name() default "";
예)
Foo foo = mock(Foo.class, withSettings().name("foo"));
      
//Below does exactly the same:
Foo foo = mock(Foo.class, "foo");
```

extraInterfaces: 모크가 구현해야 하는 추가 인터페이스를 지정합니다. 

```java
Class<?>[] extraInterfaces() default {};

예) 
Foo foo = mock(Foo.class, withSettings().extraInterfaces(Bar.class, Baz.class));
      
//now, the mock implements extra interfaces, so following casting is possible:
Bar bar = (Bar) foo;
Baz baz = (Baz) foo;
```

serializable: Mock 직렬화 여부.

```java
boolean serializable() default false;

예) 
List serializableMock = mock(List.class, withSettings().serializable());
```

lenient: 엄격한 유효성검사를 생략할지 여부.

```java
boolean lenient() default false;

예)
Foo mock = mock(Foo.class, withSettings.lenient());
```



### @MockBean

```java
import org.springframework.boot.test.mock.mockito.MockBean;
```



### @InjectMocks

Annotated된 변수를 인스턴스화하기 때문에 class 변수에 사용 해야되고, interface는 오류가 발생함.

interface 변수는 @Mock Annotation을 사용해야 한다.





